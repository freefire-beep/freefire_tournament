<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Nexus - Home</title>
    <style>
        body { background-color: #0d1117; color: white; margin: 0; padding-bottom: 80px; font-family: 'Segoe UI', sans-serif; overflow-x: hidden; }

        /* üî• ‡¶∞‡¶ø‡ßü‡ßá‡¶≤ ‡¶´‡¶æ‡ßü‡¶æ‡¶∞ ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
        .fire-wrapper { position: relative; width: 60px; height: 60px; cursor: pointer; }
        .flame {
            position: absolute; bottom: 10px; left: 50%; 
            width: 30px; height: 35px; background: orange; border-radius: 50% 50% 20% 50%;
            transform: translateX(-50%) rotate(-45deg);
            filter: blur(4px); animation: burn-fire 0.5s infinite alternate;
            box-shadow: 0 0 20px #ff4500, 0 0 40px #ff4500; z-index: 1;
        }
        @keyframes burn-fire {
            0% { transform: translateX(-50%) rotate(-45deg) scale(1); opacity: 0.8; }
            100% { transform: translateX(-50%) rotate(-45deg) scale(1.3); opacity: 1; background: #ffcc00; }
        }

        .store-btn-main {
            position: relative; z-index: 5; background: rgba(22, 27, 34, 0.9);
            border: 2px solid #ff4500; border-radius: 12px; padding: 5px;
            display: flex; flex-direction: column; align-items: center; width: 50px;
        }

        /* üìã Details Modal Style */
        #detailsModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-card {
            background: #161b22; width: 85%; max-width: 400px; border-radius: 20px; border: 2px solid #58a6ff;
            padding: 20px; position: relative; animation: popUp 0.3s ease;
        }
        @keyframes popUp { from { transform: scale(0.8); } to { transform: scale(1); } }
        .detail-item { background: #0d1117; padding: 10px; border-radius: 10px; margin-bottom: 8px; border-left: 3px solid #ff4500; }

        /* üîò Bottom Navigation Fix */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; background: #161b22; 
            display: flex; justify-content: space-around; padding: 15px 0; 
            border-top: 1px solid #30363d; z-index: 100;
        }
        .nav-btn { background:none; border:none; color:gray; cursor:pointer; font-size: 14px; transition: 0.3s; }
        .nav-btn.active { color:#58a6ff; font-weight:bold; }
    </style>
</head>
<body>

    <div style="padding: 10px 15px; display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; border-bottom: 1px solid #30363d; position: sticky; top:0; background:#0d1117; z-index:90;">
        
        <div class="fire-wrapper" onclick="location.href='store.html'">
            <div class="flame"></div>
            <div class="store-btn-main">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ff4500" stroke-width="2"><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                <b style="font-size: 8px; color: #ff8c00;">SHOP</b>
            </div>
        </div>

        <h3 style="color: #58a6ff; letter-spacing: 2px; text-shadow: 0 0 10px #58a6ff; margin: 0;">ELITE NEXUS</h3>

        <div style="text-align: right;">
            <div style="background: #161b22; padding: 5px 12px; border-radius: 20px; border: 1px solid #58a6ff; display: inline-flex; align-items: center; gap: 5px;">
                <span id="userCoins" style="font-weight: bold; color: #f0e68c;">...</span> ü™ô
                <button onclick="location.href='add-money.html'" style="background: #58a6ff; border: none; color: black; border-radius: 50%; width: 20px; height: 20px; font-weight: bold; cursor: pointer; margin-left:5px;">+</button>
            </div>
        </div>
    </div>

    <div style="padding: 20px;" id="tournamentList">
        <p style="text-align: center; color: gray;">Loading Matches...</p>
    </div>

    <div id="detailsModal">
        <div class="modal-card">
            <h2 id="mTitle" style="color: #58a6ff; margin-top: 0;"></h2>
            <div class="detail-item">üó∫Ô∏è Map: <span id="mMap" style="color:white"></span></div>
            <div class="detail-item">‚è∞ Time: <span id="mTime" style="color:white"></span></div>
            <div class="detail-item">üèÜ Prize: <span id="mPrize" style="color:white"></span></div>
            <div class="detail-item">üìú Rules: <span id="mRules" style="color:white; font-size: 12px;"></span></div>
            
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button onclick="closeM()" style="flex:1; padding:12px; background:#30363d; color:white; border:none; border-radius:10px; cursor:pointer;">CANCEL</button>
                <button id="joinConfirmBtn" style="flex:2; padding:12px; background:linear-gradient(45deg, #ff4500, #ff8c00); color:white; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">CONFIRM JOIN</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <button onclick="location.href='inbox.html'" class="nav-btn">üìß Inbox</button>
        <button onclick="location.href='home.html'" class="nav-btn active">üè† Home</button>
        <button onclick="location.href='account.html'" class="nav-btn">üë§ Account</button>
    </div>

    <script>
        const user = JSON.parse(sessionStorage.getItem('user'));
        if (!user) window.location.href = 'index.html';

        let allPackages = [];

        async function loadData() {
            try {
                const res = await fetch(`/api/get-packages?gameId=${user.gameId}`);
                const data = await res.json();
                allPackages = data.packages;
                document.getElementById('userCoins').innerText = data.coins;

                const list = document.getElementById('tournamentList');
                list.innerHTML = "";

                allPackages.forEach(pkg => {
                    const joined = data.joinedPackages.includes(pkg.Title);
                    list.innerHTML += `
                        <div style="background: #161b22; padding: 15px; border-radius: 15px; border: 1px solid #30363d; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #58a6ff;">${pkg.Title}</h3>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                                <span style="color: #8b949e;">Entry: ${pkg.Fee} ü™ô</span>
                                <button onclick="openM('${pkg.Title}')" style="background: ${joined ? '#30363d' : '#238636'}; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor:pointer;">
                                    ${joined ? 'JOINED ‚úÖ' : 'JOIN NOW'}
                                </button>
                            </div>
                        </div>
                    `;
                });
            } catch (err) { console.error(err); }
        }

        function openM(title) {
            const pkg = allPackages.find(p => p.Title === title);
            if(!pkg) return;
            document.getElementById('mTitle').innerText = pkg.Title;
            document.getElementById('mMap').innerText = pkg.Map || "Bermuda";
            document.getElementById('mTime').innerText = pkg.Time || "TBA";
            document.getElementById('mPrize').innerText = pkg.Prize_Pool || "Check Rules";
            document.getElementById('mRules').innerText = pkg.Rules || "No Hack / No Teamup";
            
            document.getElementById('joinConfirmBtn').onclick = () => processJoin(pkg.Title, pkg.Fee);
            document.getElementById('detailsModal').style.display = 'flex';
        }

        function closeM() { document.getElementById('detailsModal').style.display = 'none'; }

        async function processJoin(title, fee) {
            closeM();
            if (!confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ${title} ‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú‡ßá ${fee} ‡¶ï‡ßü‡ßá‡¶® ‡¶¶‡¶ø‡ßü‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`)) return;
            
            try {
                const res = await fetch('/api/purchase', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ gameId: user.gameId, fee, packageName: title, userName: user.name })
                });
                const result = await res.json();
                if(res.ok) { 
                    alert("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá‡¶®!"); 
                    loadData(); 
                } else { 
                    alert(result.message); 
                }
            } catch (e) { alert("‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ!"); }
        }

        loadData();
    </script>
</body>
</html>
