<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Nexus - Home</title>
    <style>
        body { background-color: #0d1117; color: white; margin: 0; padding-bottom: 80px; font-family: 'Segoe UI', sans-serif; overflow-x: hidden; }

        /* üî• ‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
        .fire-wrapper { position: relative; width: 60px; height: 60px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; }
        .flame {
            position: absolute; bottom: 15px; width: 35px; height: 35px;
            background: radial-gradient(circle, #ffcc00 20%, #ff4500 60%, rgba(255, 69, 0, 0) 80%);
            border-radius: 50% 50% 20% 50%; transform: rotate(-45deg);
            filter: blur(2px); animation: burn 0.4s infinite alternate;
            box-shadow: 0 0 15px #ff4500; z-index: 1;
        }
        @keyframes burn { 0% { transform: rotate(-45deg) scale(1); opacity: 0.8; } 100% { transform: rotate(-45deg) scale(1.2); opacity: 1; } }
        .store-btn-box { position: relative; z-index: 5; background: rgba(22, 27, 34, 0.9); border: 1px solid #ff4500; border-radius: 10px; padding: 4px 8px; text-align: center; }

        /* üìã ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        #detailsModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-card {
            background: #161b22; width: 85%; max-width: 400px; border-radius: 20px; border: 1px solid #58a6ff;
            padding: 20px; box-shadow: 0 0 20px rgba(88, 166, 255, 0.3); animation: pop 0.3s ease;
        }
        @keyframes pop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .detail-item { background: #0d1117; padding: 10px; border-radius: 10px; margin-bottom: 8px; border-left: 3px solid #ff4500; font-size: 14px; }

        /* üîò ‡¶®‡ßç‡¶Ø‡¶æ‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #161b22; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #30363d; z-index: 100; }
        .nav-btn { background:none; border:none; color:gray; cursor:pointer; font-size: 14px; text-decoration: none; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-btn.active { color:#58a6ff; font-weight:bold; }
        
        button:disabled { opacity: 0.5; cursor: not-allowed !important; }
    </style>
</head>
<body>

    <div style="padding: 10px 15px; display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; border-bottom: 1px solid #30363d; position: sticky; top:0; background:#0d1117; z-index:90;">
        <div class="fire-wrapper" onclick="location.href='store.html'">
            <div class="flame"></div>
            <div class="store-btn-box">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#ffcc00" stroke-width="2.5"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                <div style="font-size: 8px; color: #ffcc00; font-weight: bold;">STORE</div>
            </div>
        </div>
        <h3 style="color: #58a6ff; letter-spacing: 1px; margin: 0; font-weight: 800;">ELITE NEXUS</h3>
        <div style="text-align: right;">
            <div style="background: #161b22; padding: 5px 12px; border-radius: 20px; border: 1px solid #58a6ff; display: inline-flex; align-items: center; gap: 6px;">
                <span id="userCoins" style="font-weight: bold; color: #f0e68c; font-size: 14px;">...</span> ü™ô
                <button onclick="location.href='add-money.html'" style="background: #58a6ff; border: none; color: black; border-radius: 50%; width: 20px; height: 20px; font-weight: bold; cursor: pointer;">+</button>
            </div>
        </div>
    </div>

    <div style="padding: 20px;">
        <h2 style="font-size: 18px; border-left: 4px solid #58a6ff; padding-left: 10px; margin-bottom: 20px;">Available Matches</h2>
        <div id="tournamentList">
            <p style="text-align: center; color: gray;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>
    </div>

    <div id="detailsModal">
        <div class="modal-card">
            <h2 id="mTitle" style="color: #58a6ff; margin-top: 0; font-size: 20px;"></h2>
            <div class="detail-item">üó∫Ô∏è <b>Map:</b> <span id="mMap" style="color:white"></span></div>
            <div class="detail-item">‚è∞ <b>Time:</b> <span id="mTime" style="color:white"></span></div>
            <div class="detail-item">üèÜ <b>Prize:</b> <span id="mPrize" style="color:white"></span></div>
            <div class="detail-item">üìú <b>Rules:</b> <span id="mRules" style="color:white"></span></div>
            <div style="margin-top: 25px; display: flex; gap: 10px;">
                <button onclick="closeM()" style="flex:1; padding:12px; background:#30363d; color:white; border:none; border-radius:10px; cursor:pointer;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                <button id="joinConfirmBtn" style="flex:2; padding:12px; background:linear-gradient(45deg, #238636, #2ea043); color:white; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <a href="inbox.html" class="nav-btn"><span>üìß</span><span>Inbox</span></a>
        <a href="home.html" class="nav-btn active"><span>üè†</span><span>Home</span></a>
        <a href="account.html" class="nav-btn"><span>üë§</span><span>Account</span></a>
    </div>

    <script>
        const user = JSON.parse(sessionStorage.getItem('user'));
        if (!user) window.location.href = 'index.html';

        let allPackages = [];
        let isLock = false; // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶≤‡¶ï

        async function syncData() {
            try {
                const res = await fetch(`/api/get-packages?gameId=${user.gameId}`);
                const data = await res.json();
                allPackages = data.packages;
                document.getElementById('userCoins').innerText = data.coins;
                renderPackages(data.joinedPackages || []);
            } catch (err) { console.error(err); }
        }

        function renderPackages(joinedList) {
            const list = document.getElementById('tournamentList');
            list.innerHTML = "";
            allPackages.forEach(pkg => {
                const alreadyJoined = joinedList.includes(pkg.Title);
                list.innerHTML += `
                    <div style="background: #161b22; padding: 18px; border-radius: 15px; border: 1px solid #30363d; margin-bottom: 15px;">
                        <h3 style="margin: 0;">${pkg.Title}</h3>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <div style="color: gray;">Entry: <span style="color:#f0e68c;">${pkg.Fee} ü™ô</span></div>
                            <button class="j-btn" 
                                onclick="openM('${pkg.Title}')" 
                                ${alreadyJoined ? 'disabled' : ''}
                                style="background: ${alreadyJoined ? '#30363d' : '#238636'}; color: white; border: none; padding: 10px 18px; border-radius: 8px; font-weight: bold;">
                                ${alreadyJoined ? 'JOINED ‚úÖ' : 'JOIN NOW'}
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        function openM(title) {
            if(isLock) return;
            const pkg = allPackages.find(p => p.Title === title);
            document.getElementById('mTitle').innerText = pkg.Title;
            document.getElementById('mMap').innerText = pkg.Map || "Bermuda";
            document.getElementById('mTime').innerText = pkg.Time || "TBA";
            document.getElementById('mPrize').innerText = pkg.Prize_Pool || "Check Rules";
            document.getElementById('mRules').innerText = pkg.Rules || "No Hack";
            document.getElementById('joinConfirmBtn').onclick = () => startJoin(pkg.Title, pkg.Fee);
            document.getElementById('detailsModal').style.display = 'flex';
        }

        function closeM() { document.getElementById('detailsModal').style.display = 'none'; }

        async function startJoin(title, fee) {
            if(isLock) return;
            closeM();
            if(!confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö‡¶ü‡¶ø‡¶§‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) return;

            // üõë ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶¨ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßç‡¶≤‡¶ï
            isLock = true;
            const btns = document.querySelectorAll('.j-btn');
            btns.forEach(b => b.disabled = true);

            try {
                const res = await fetch('/api/purchase', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ gameId: user.gameId, fee, packageName: title, userName: user.name })
                });
                const result = await res.json();
                if(res.ok) {
                    alert("‡¶ú‡ßü‡ßá‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                    await syncData();
                } else {
                    alert(result.message);
                }
            } catch (e) { alert("Error!"); }

            // ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶≤‡¶ï ‡¶ñ‡ßã‡¶≤‡¶æ
            setTimeout(() => {
                isLock = false;
                syncData(); // ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡ßü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶ö‡ßá‡¶ï
            }, 5000);
        }

        syncData();
    </script>
</body>
                                                       </html>
                                           
